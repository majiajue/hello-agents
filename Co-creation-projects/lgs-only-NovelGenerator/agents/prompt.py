OUTLINE_PROMPT = """你是一位资深故事架构师与编辑。请基于以下输入，生成一份约{target_length}字的中文长篇小说大纲，要求紧凑清晰、信息密度高。

【用户想法】
{user_input}

【小说标题】
{title}

【标签】
{tags}

【总目标】
- 字数约{target_length}字（允许±10%），全程使用中文。
- 提供完整故事脉络：起承转合明确，动机与因果自洽。
- 保持鲜明辨识度：世界观/结构/母题至少一处明显创新。
- 采用分卷或分段形式，并细化到章节级要点。

【输出结构】
一、故事概念与独特性
- 用数句话概括核心母题与价值主张。
- 提炼3个左右作品卖点与差异化策略。
- 指定叙事视角与形式。

二、世界观与设定
- 概述时空背景与主要社会结构。
- 列出关键规则/禁忌/代价及其约束效果。
- 点出若干重要地点或象征物及叙事功能。

三、人物谱系与关系网
- 主角群：目标、缺陷、成长弧线与彼此关系。
- 反派或对抗势力：动机、方法、与主线冲突点。
- 关键配角：在剧情推进、张力制造或主题承载上的功能。

四、叙事结构总览
- 给出整体结构方案（如三幕/四幕/环形）及各幕核心目标和关节点。
- 描述全书主题推进与情感曲线（主要高潮、低谷与超越时刻）。

五、分卷/分段规划（核心）
- 按卷列出：卷标题 + 卷概述（约300–500字）。
- 每卷给出6–10章章节要点（每章2–3行，标注冲突/悬念/反转）。
- 概括每卷的阶段性目标、关键事件、人物关系变化与伏笔回收。

六、高潮与关键转折设计
- 规划至少3个大型高潮：触发条件、冲突构型、代价与后果。
- 指出主要反转的误导点与真实点，并说明与主题的呼应。
- 简述高潮后的余波与人物选择，体现成长或坠落。

七、节奏控制与悬念布置
- 总体推进节奏策略（张弛、留白、信息揭示步幅）。
- 设计短/中/长三类悬念链，并说明对应关键节点。
- 要求每卷或分段结尾具备清晰“钩子”（悬念、抉择、危机或新发现）。

八、原创性与防重策略
- 指出几类市场常见套路，并说明本作的改写或规避方式。
- 总结本作的原创钩子与不可替代元素（设定/人物关系/结构/意象等）。
- 给出相似风险评估与必要的规避建议。

九、主题深化与象征系统
- 说明主题如何通过剧情、人物、景观与语言多维呈现。
- 设计若干贯穿意象或隐喻，并绑定到关键场景。
- 交代结尾的主题回应方式（开放/确定/反讽）及读者余味设计。

十、延展与改编可能
- 提出2–3条可扩展支线及其冲突核心与成长空间。
- 概述影视/漫画/广播剧等改编潜力与关键视觉化要点。

十一、标签融入策略
- 将标签具体映射到人物、场景、冲突与意象中。
- 指定每卷若干与标签强关联的事件或视觉化片段。

十二、写作风格与审美基调
- 给出文体与语言节奏建议及叙述者语气与距离。
- 说明预期读者体验的侧重（张力/代入/思辨/反讽等）。

【校验与格式】
- 确保逻辑自洽、角色驱动与伏笔呼应，避免模板化空话。
- 每卷结尾具备清晰钩子，原创差异点具体可见。
- 使用以上十二个一级标题逐条展开，全文为中文，约{target_length}字（允许±10%）。
"""

CHAPTER_PROMPT = """请基于给定信息，生成一章完整的中文小说内容。

【输入信息】
- 小说大纲：{outline}
- 前一章正文：{prev_chapter}
- 前几章摘要：{prev_summaries}
- 本章历史生成内容：{chapter_history}
- 对本章历史生成内容的评判结果：{evaluation}
- 用户输入或对本章的预测摘要：{user_input}

【生成目标】
- 输出本章的：本章章节序号与标题、本章摘要、本章正文、下一章摘要预测。
- 内容需严格遵循大纲与既有剧情，保证人物行为与设定前后一致。
- 在本章内设置局部高潮或悬念，并为下一章制造明确钩子。

【输出格式】
请仅输出一个标准的 JSON 对象，不要包含 Markdown 代码块（如 ```json ... ```），格式如下：
{{
    "title": "第几章-标题",
    "summary": "本章摘要（200字以内）",
    "content": "本章正文内容...",
    "next_chapter_prediction": "下一章摘要预测（包含核心冲突或悬念焦点）"
}}

【具体要求】
- 全文使用中文。
- 本章正文字数约为{chapter_length}字（允许±10%）。
- 合理引用前几章摘要和本章预测摘要：既兑现承诺，又保留惊喜。
- 当预测摘要与大纲或前文冲突时，以大纲与人物逻辑为最高优先级。
- 在“next_chapter_prediction”中，清楚指出下一章的核心冲突或悬念焦点。
- 特殊情况：如果判断本章为全书或本卷的大结局：
  1. "title" 字段请包含“大结局”字样（如“第X章-标题（大结局）”）。
  2. "next_chapter_prediction" 字段请置为空字符串（""）。
"""

CHAPTER_START_PROMPT = """请基于给定信息，作为开篇章节，生成一章完整的中文小说内容。

【输入信息】
- 小说大纲：{outline}
- 本章历史生成内容：{chapter_history}
- 对本章历史生成内容的评判结果：{evaluation}
- 用户输入或本章核心事件：{user_input}

【生成目标】
- 输出本章的：本章章节序号与标题、本章摘要、本章正文、下一章摘要预测。
- 作为第一章，重点在于：
  1. 快速建立世界观与氛围，但避免枯燥的设定堆砌。
  2. 鲜明地引出主角，展现其性格特征或当前处境。
  3. 设置“激励事件”（Inciting Incident），打破主角的平静生活，开启故事主线。
- 内容需严格遵循大纲设定。
- 在本章结尾设置悬念或冲突，吸引读者继续阅读。

【输出格式】
请仅输出一个标准的 JSON 对象，不要包含 Markdown 代码块（如 ```json ... ```），格式如下：
{{
    "title": "第一章-标题",
    "summary": "本章摘要（200字以内）",
    "content": "本章正文内容...",
    "next_chapter_prediction": "下一章摘要预测（包含核心冲突或悬念焦点）"
}}

【具体要求】
- 全文使用中文。
- 本章正文字数约为{chapter_length}字（允许±10%）。
- 开篇要抓人眼球（黄金三章原则）。
- 在“next_chapter_prediction”中，清楚指出下一章的核心冲突或悬念焦点。
"""

CHAPTER_REVIEW_PROMPT = """请对以下新生成的章节进行多维度审核与评判。

【输入信息】
- 小说大纲：{outline}
- 前一章正文：{prev_chapter}
- 前几章摘要：{prev_summaries}
- 待审核章节：{chapter_content}

【审核维度】
1. **大纲契合度**：是否偏离主线？人物行为是否符合大纲设定？
2. **原创性与故事性**：
   - 是否存在明显的“AI味”（平铺直叙、情感空洞、逻辑机械）？
   - 故事是否丰满？重点情节是否有详细、生动的描写？
   - 是否与市面热门网文高度雷同（套路化）？
3. **人物塑造**：人物性格是否鲜明、丰满？对话与行动是否贴合人设？
4. **节奏与张力**：是否有足够的戏剧冲突？阅读体验是否流畅？

【输出结构】
请严格按照以下格式输出评审意见（不要输出多余的开场白）：
- 【通过】
- 【不通过】**具体修改建议如下**：
1. [大纲契合度] ...
2. [原创性与故事性] ...
3. [人物塑造] ...
4. [其他建议] ...
"""
